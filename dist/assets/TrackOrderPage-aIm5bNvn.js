import{h as I,g as L,u as D,b as z,f as E,r as m,j as t,R as k,L as B,a as $,e as j}from"./index-JHV42PaI.js";const q=()=>{const{orderNumber:x}=I(),N=L(),A=D(),{t:n}=z(),{token:h}=E(),[a,v]=m.useState(null),[O,p]=m.useState(!0),[F,d]=m.useState(""),[u,S]=m.useState(!1),[f,w]=m.useState(!1);m.useEffect(()=>{var g;const r=async()=>{if(!x){p(!1),d(n("No Order Number Provided"));return}try{p(!0);const e=await $(j.getOrderByNumber(x),{headers:{Authorization:`Bearer ${h}`}});if(e.success&&e.data)v(e.data);else throw new Error(e.message||n("Could Not Find Order Details"))}catch(e){console.error("Fetch order error:",e),d(e.message||n("Could Not Find Order Details"))}finally{p(!1)}},o=(g=N.state)==null?void 0:g.order;o?(v(o),p(!1)):r()},[x,N.state,n,h]);const b=["pending","confirmed","shipped","delivered"],y=a?b.indexOf(a.status):-1,l=m.useMemo(()=>{if(!(a!=null&&a.shippingAddress))return null;try{return JSON.parse(a.shippingAddress)}catch(r){return console.error("Failed to parse shipping address:",r),null}},[a==null?void 0:a.shippingAddress]),c=m.useMemo(()=>{if(!(a!=null&&a.billingAddress))return null;try{return JSON.parse(a.billingAddress)}catch(r){return console.error("Failed to parse billing address:",r),null}},[a==null?void 0:a.billingAddress]),P=async()=>{if(!(!a||u)){if(!h){d(n("Please Login To Cancel"));return}if(!["pending","confirmed"].includes(a.status)){d(n("Order Can not Be Cancelled"));return}S(!0);try{console.log("Attempting to cancel order:",a.id,"Endpoint:",j.cancelOrder(a.id));const r=await $(j.cancelOrder(a.id),{method:"PATCH",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}});if(console.log("Cancel order response:",r),r.success)A("/order-cancelled",{state:{orderNumber:x,message:n("Order Cancelled Success")}});else throw new Error(r.message||n("Failed To Cancel Order"))}catch(r){console.error("Cancel order error:",r),d(r.message||n("Failed To Cancel Order"))}finally{S(!1)}}},T=async()=>{if(a){w(!0);try{const r=document.createElement("script");r.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js",r.async=!0,document.body.appendChild(r),r.onload=async()=>{try{const o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js",o.async=!0,document.body.appendChild(o),o.onload=()=>{const{jsPDF:g}=window.jspdf,e=new g({orientation:"portrait",unit:"mm",format:"a4"});e.setFont("helvetica"),e.setFontSize(20),e.setTextColor(0,0,0),e.text("ShopZeo",20,20),e.setFontSize(10),e.text("123 Commerce Street, Bangalore, India",20,28),e.text("Email: support@shopzeo.com | Phone: +91-123-456-7890",20,34),e.setFontSize(16),e.setFont("helvetica","bold"),e.text(`Invoice #${a.orderNumber}`,140,20,{align:"right"}),e.setFontSize(12),e.setFont("helvetica","normal"),e.text(`Order Date: ${new Date(a.createdAt).toLocaleDateString("en-IN")}`,140,28,{align:"right"}),e.text(`Invoice Date: ${new Date().toLocaleDateString("en-IN")}`,140,34,{align:"right"});let s=40;e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Billing Address:",20,s),e.setFont("helvetica","normal"),s+=6,c?(e.text(`${c.firstName||""} ${c.lastName||""}`.trim(),20,s),s+=6,e.text(c.addressLine1||"",20,s),s+=6,e.text(`${c.city||""} - ${c.postalCode||""}`.trim(),20,s),s+=6,e.text(c.country||"",20,s),s+=6,e.text(`Phone: ${c.phone||""}`,20,s)):(e.text("Same as shipping address",20,s),s+=6),s+=6,e.setFont("helvetica","bold"),e.text("Shipping Address:",20,s),e.setFont("helvetica","normal"),s+=6,l?(e.text(`${l.firstName||""} ${l.lastName||""}`.trim(),20,s),s+=6,e.text(l.addressLine1||"",20,s),s+=6,e.text(`${l.city||""} - ${l.postalCode||""}`.trim(),20,s),s+=6,e.text(l.country||"",20,s),s+=6,e.text(`Phone: ${l.phone||""}`,20,s)):e.text("Not available",20,s),s+=10,e.autoTable({startY:s,head:[["Item","Quantity","Unit Price","Total"]],body:(a.items||[]).map(i=>[i.productName||"Unknown Product",i.quantity||0,`₹${parseFloat(i.unitPrice||i.totalPrice/(i.quantity||1)).toFixed(2)}`,`₹${parseFloat(i.totalPrice||0).toFixed(2)}`]),styles:{fontSize:10,cellPadding:3,halign:"left",valign:"middle"},headStyles:{fillColor:[0,102,204],textColor:[255,255,255],fontSize:12,halign:"center"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:20,right:20},didDrawPage:i=>{i.pageNumber<e.internal.getNumberOfPages()&&(s=20)}}),s=e.lastAutoTable.finalY+10,e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Payment Summary:",20,s),e.setFont("helvetica","normal"),s+=6,e.text(`Subtotal: ₹${parseFloat(a.subtotal||0).toFixed(2)}`,20,s),s+=6,e.text(`Shipping: ₹${parseFloat(a.shippingAmount||0).toFixed(2)}`,20,s),s+=6,e.setFont("helvetica","bold"),e.text(`Total: ₹${parseFloat(a.totalAmount||0).toFixed(2)}`,20,s),s+=10,e.setFontSize(10),e.setFont("helvetica","italic"),e.text("Thank you for shopping with ShopZeo!",20,s),s+=6,e.text("For support, contact: support@shopzeo.com",20,s);const C=e.internal.getNumberOfPages();for(let i=1;i<=C;i++)e.setPage(i),e.text(`Page ${i} of ${C}`,200,290,{align:"right"});e.save(`invoice_${a.orderNumber}.pdf`),document.body.removeChild(o),document.body.removeChild(r)},o.onerror=()=>d(n("Failed To Load Autotable"))}catch(o){console.error("Invoice generation error (autoTable):",o),d(n("Error Generating Invoice")+": "+o.message)}},r.onerror=()=>d(n("failedToLoadJspdf"))}catch(r){console.error("Invoice generation error (jsPDF):",r),d(n("Error Generating Invoice")+": "+r.message)}finally{w(!1)}}};return t.jsx("div",{className:"bg-gray-100 min-h-screen py-10",children:t.jsxs("div",{className:"container mx-auto px-4",children:[t.jsx("h1",{className:"text-3xl font-bold text-center text-gray-800 mb-8",children:n("Track Your Order")}),O&&t.jsx("p",{className:"text-center text-lg",children:n("loadingOrderDetails")}),F&&t.jsx("p",{className:"text-center text-red-500 text-lg",children:F}),a&&t.jsxs("div",{className:"max-w-4xl mx-auto bg-white p-6 md:p-8 rounded-2xl shadow-lg",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 pb-4 border-b",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Order #",a.orderNumber]}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Placed on"," ",new Date(a.createdAt).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"})]})]}),t.jsx("div",{className:"mt-3 sm:mt-0 text-left sm:text-right",children:t.jsxs("p",{className:"text-lg font-semibold text-gray-700",children:["Total: ₹",parseFloat(a.totalAmount).toFixed(2)]})})]}),t.jsx("div",{className:"mb-10",children:t.jsx("div",{className:"flex items-center justify-between",children:b.map((r,o)=>t.jsxs(k.Fragment,{children:[t.jsxs("div",{className:"flex flex-col items-center w-1/4",children:[t.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-lg transition-colors duration-300 ${o<=y?"bg-blue-600":"bg-gray-300"}`,children:t.jsx("span",{children:"✓"})}),t.jsx("p",{className:`mt-2 text-xs sm:text-sm font-semibold text-center capitalize ${o<=y?"text-blue-600":"text-gray-500"}`,children:r})]}),o<b.length-1&&t.jsx("div",{className:`flex-1 h-1 transition-colors duration-300 ${o<y?"bg-blue-600":"bg-gray-300"}`})]},r))})}),t.jsxs("div",{className:"mb-8",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Items in your order"}),t.jsx("div",{className:"space-y-4",children:a.items&&a.items.map(r=>{var o;return t.jsxs("div",{className:"flex items-center bg-gray-50 p-4 rounded-lg",children:[t.jsx("img",{src:((o=r.product)==null?void 0:o.image_1)||"https://via.placeholder.com/100",alt:r.productName,className:"w-16 h-16 object-cover rounded-md mr-4 shadow-sm"}),t.jsxs("div",{className:"flex-grow",children:[t.jsx("p",{className:"font-semibold text-gray-800",children:r.productName}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Qty: ",r.quantity]})]}),t.jsxs("p",{className:"font-semibold text-gray-800",children:["₹",parseFloat(r.totalPrice).toFixed(2)]})]},r.id)})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 border-t border-gray-200 pt-8",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Shipping Address"}),l?t.jsxs("div",{className:"text-gray-600 leading-relaxed",children:[t.jsxs("p",{className:"font-bold",children:[l.firstName," ",l.lastName]}),t.jsx("p",{children:l.addressLine1}),t.jsxs("p",{children:[l.city," - ",l.postalCode]}),t.jsx("p",{children:l.country}),t.jsxs("p",{children:["Phone: ",l.phone]})]}):t.jsx("p",{children:"Address not available."})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Payment Summary"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Subtotal"}),t.jsxs("span",{className:"font-semibold text-gray-800",children:["₹",parseFloat(a.subtotal).toFixed(2)]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Shipping"}),t.jsxs("span",{className:"font-semibold text-gray-800",children:["₹",parseFloat(a.shippingAmount).toFixed(2)]})]}),t.jsxs("div",{className:"flex justify-between border-t pt-2 mt-2",children:[t.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total"}),t.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["₹",parseFloat(a.totalAmount).toFixed(2)]})]})]})]})]}),t.jsxs("div",{className:"mt-8 flex justify-end gap-4",children:[["pending","confirmed"].includes(a.status)&&t.jsx("button",{onClick:P,disabled:u,className:`bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 ${u?"opacity-70 cursor-not-allowed":""}`,children:n(u?"cancelling":"Cancel Order")}),t.jsx("button",{onClick:T,disabled:f,className:`bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 ${f?"opacity-70 cursor-not-allowed":""}`,children:n(f?"Generating Invoice":"Download Invoice")})]})]}),t.jsx("div",{className:"text-center mt-8",children:t.jsx(B,{to:"/products",className:"bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-transform transform hover:scale-105",children:n("Continue Shopping")})})]})})};export{q as default};
