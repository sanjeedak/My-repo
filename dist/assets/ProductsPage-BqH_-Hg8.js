import{c as J,j as e,S as K,d as Y,u as O,f as ee,X as se,A as te,n as v,b as ae,g as re,h as ne,r as c,a as z,e as _,t as oe,i as ie}from"./index-JHV42PaI.js";import{P as le}from"./ProductCard-BUBR25pb.js";import{P as d}from"./index-Dqfn9z8l.js";import{P as ce}from"./Pagination-DgnuGieu.js";import{S as de}from"./shopping-cart-CxxRy6Tm.js";import{I as me}from"./InfoCards-DKFlAvRp.js";import"./eye-CmzZc3tr.js";import"./heart-Dd0oiCNL.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],xe=J("zap",ge),S={maxPrice:1e4},Q=({filters:s,setFilters:m,availableStores:x=[]})=>{const u=Number(s.maxPrice)||S.maxPrice,p=100,a=S.maxPrice,j=r=>{const o=s.stores.includes(r)?s.stores.filter(i=>i!==r):[...s.stores,r];m(i=>({...i,stores:o,currentPage:1}))},P=r=>{m(o=>({...o,minRating:r,currentPage:1}))},g=r=>{const o=Number(r.target.value);isNaN(o)||m(i=>({...i,maxPrice:o,currentPage:1}))},h=()=>{m({maxPrice:a,stores:[],minRating:0,sortBy:"created_at",order:"desc"})};return e.jsxs("aside",{className:"space-y-6 w-full",children:[e.jsx("h3",{className:"text-lg font-bold border-b pb-2 text-gray-800",children:"Filter By"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-gray-700",children:"Price Range"}),e.jsx("div",{className:"px-2",children:e.jsx("input",{type:"range",min:"0",max:a,step:p,value:u,onChange:g,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue"})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 mt-3",children:[e.jsx("span",{children:"₹0"}),e.jsxs("span",{children:["₹",u.toLocaleString("en-IN")]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-gray-700",children:"Stores"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:x.length>0?x.map(r=>e.jsxs("label",{className:"flex items-center text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.stores.includes(r.slug),onChange:()=>j(r.slug),className:"h-4 w-4 rounded border-gray-300 text-brand-blue focus:ring-brand-blue"}),e.jsx("span",{className:"ml-2 text-gray-700",children:r.name})]},r.id)):e.jsx("p",{className:"text-sm text-gray-500",children:"No stores available"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-gray-700",children:"Minimum Rating"}),e.jsx("div",{className:"flex flex-col items-start space-y-1",children:[4,3,2,1].map(r=>e.jsxs("button",{onClick:()=>P(r),className:`flex items-center text-sm p-1 rounded-md transition-colors w-full ${s.minRating===r?"bg-blue-100 text-brand-blue":"hover:bg-gray-100"}`,children:[[...Array(5)].map((o,i)=>e.jsx(K,{filled:i<r},i)),e.jsx("span",{className:"ml-2 text-gray-600",children:"& Up"})]},r))})]}),e.jsx("button",{onClick:h,className:"w-full text-center text-sm font-semibold text-brand-blue hover:bg-blue-50 py-2 rounded-md transition-colors",children:"Clear All Filters"})]})};Q.propTypes={filters:d.shape({maxPrice:d.oneOfType([d.number,d.string]),stores:d.arrayOf(d.string),minRating:d.number,sortBy:d.string,order:d.string}).isRequired,setFilters:d.func.isRequired,availableStores:d.arrayOf(d.shape({id:d.string,name:d.string,slug:d.string}))};const ue=({product:s,onClose:m})=>{const{addToCart:x}=Y(),u=O(),{isAuthenticated:p}=ee();if(!s)return null;const a=g=>g?g.startsWith("http")?g:`${te}/${g}`:"https://placehold.co/400x400?text=No+Image",j=g=>{var o;if(g.stopPropagation(),!p){v.error("Please log in to continue."),u("/signin");return}const h=((o=s==null?void 0:s.store)==null?void 0:o.id)||(s==null?void 0:s.store_id);if(!s||!s.id||!s.name||!h){console.error("Invalid product data (missing store_id):",s),v.error("Cannot buy this item: missing store information.");return}const r=x({...s,store_id:h});v.promise(r,{loading:"Preparing for checkout...",success:()=>(m(),u("/checkout"),"Redirecting to checkout..."),error:i=>`Error: ${i.message||"Could not prepare for checkout."}`})},P=g=>{var o;if(g.stopPropagation(),!p){v.error("Please log in to add items to your cart."),u("/signin");return}const h=((o=s==null?void 0:s.store)==null?void 0:o.id)||(s==null?void 0:s.store_id);if(!s||!s.id||!s.name||!h){console.error("Invalid product data (missing store_id):",s),v.error("Cannot add this item: missing store information.");return}const r=x({...s,store_id:h});v.promise(r,{loading:"Adding to cart...",success:i=>(i.success&&m(),`${s.name} added to cart!`),error:i=>`Error: ${i.message||"Could not add to cart."}`})};return e.jsxs("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:m,children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col md:flex-row overflow-hidden animate-fadeIn",onClick:g=>g.stopPropagation(),children:[e.jsx("div",{className:"w-full md:w-1/2 p-4 flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100",children:e.jsx("img",{src:a(s.image),alt:s.name,className:"max-w-full max-h-80 object-contain rounded-md shadow-sm"})}),e.jsxs("div",{className:"w-full md:w-1/2 p-6 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 leading-tight",children:s.name}),e.jsx("button",{onClick:m,"aria-label":"Close",className:"p-1.5 rounded-full text-gray-500 hover:bg-gray-200 transition",children:e.jsx(se,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-2xl font-extrabold text-blue-600",children:["₹",s.price]}),s.originalPrice&&e.jsxs("p",{className:"text-sm text-gray-500 line-through",children:["₹",s.originalPrice]}),s.quantity&&e.jsxs("p",{className:"text-xs mt-1 text-green-600",children:[s.quantity," items in stock"]})]}),e.jsx("div",{className:"text-sm text-gray-600 mb-6 overflow-y-auto pr-1 custom-scroll flex-grow",children:e.jsx("p",{children:s.description||"No description available."})}),e.jsx("div",{className:"pt-4 border-t mt-auto",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:P,className:"flex-1 flex items-center justify-center gap-2 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-semibold shadow-md",children:[e.jsx(de,{className:"w-5 h-5"}),"Add to Cart"]}),e.jsxs("button",{onClick:j,className:"flex-1 flex items-center justify-center gap-2 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition font-semibold shadow-md",children:[e.jsx(xe,{className:"w-5 h-5"}),"Buy Now"]})]})})]})]}),e.jsx("style",{children:`
          .animate-fadeIn {
            animation: fadeIn 0.25s ease-out;
          }
          @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
          }
          .custom-scroll::-webkit-scrollbar {
            width: 4px;
          }
          .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
          }
        `})]})},we=()=>{const{t:s}=ae(),m=O(),x=re(),{slug:u,storeId:p}=ne(),a=c.useMemo(()=>new URLSearchParams(x.search),[x.search]),[j,P]=c.useState([]),[g,h]=c.useState(!0),[r,o]=c.useState(""),[i,V]=c.useState([]),[k,W]=c.useState({currentPage:1,totalPages:1,totalItems:0}),[R,$]=c.useState(null),[C,A]=c.useState(a.get("q")||""),[f,I]=c.useState({maxPrice:S.maxPrice,brands:[],minRating:0,sortBy:"created_at",order:"desc"}),B=100,X=c.useMemo(()=>{const t=a.get("q");if(t)return`${s("Search results for")} "${t}"`;const n=a.get("section");if(n==="featured")return s("featured_products");if(n==="flash_deal")return s("flash_deals");if(n==="top_sellers")return s("top_sellers");const b=u||a.get("category");if(b)return`${s("Products in")} ${b.replace(/-/g," ")}`;const y=a.get("brand");return y?`${s("Products from")} ${y.replace(/-/g," ")}`:s("All Products")},[a,u,s]);c.useEffect(()=>{z(_.brands).then(t=>{var n;t.success&&Array.isArray((n=t.data)==null?void 0:n.brands)&&V(t.data.brands)}).catch(t=>console.error("Failed to fetch brands:",t))},[]);const q=c.useCallback(async t=>{var n,b,y,L;h(!0),o("");try{let w;const N=new URLSearchParams({page:t,limit:B,sortBy:f.sortBy,order:f.order,maxPrice:1e4,minRating:f.minRating});p?w=_.productsByStore(p):w=_.products,f.brands.length>0&&N.set("brands",f.brands.join(","));const E=u||a.get("category");E&&N.set("category",E);const T=a.get("brand");T&&N.set("brand",T);const U=a.get("section");U&&N.set("section",U);const F=a.get("q");F&&N.set("q",F);const l=await z(`${w}?${N.toString()}`),M=((l==null?void 0:l.products)||((n=l==null?void 0:l.data)==null?void 0:n.products)||[]).map(oe);P(M),W({currentPage:((b=l==null?void 0:l.pagination)==null?void 0:b.currentPage)||1,totalPages:((y=l==null?void 0:l.pagination)==null?void 0:y.totalPages)||1,totalItems:((L=l==null?void 0:l.pagination)==null?void 0:L.total)||0}),M.length===0&&o(s("No products found"))}catch(w){console.error("ProductsPage API error:",w),o("Could not fetch products. Please try again later."),P([])}finally{h(!1)}},[f,B,u,a,s,p]),Z=a.get("brand"),D=u||a.get("category");c.useEffect(()=>{I({maxPrice:S.maxPrice,brands:[],minRating:0,sortBy:"created_at",order:"desc"}),A(a.get("q")||"")},[Z,D,a]),c.useEffect(()=>{const t=parseInt(a.get("page")||"1",10);q(t)},[q,a]);const G=t=>{const n=new URLSearchParams(a);n.set("page",t),m(`${x.pathname}?${n.toString()}`)},H=t=>{t.preventDefault();const n=new URLSearchParams(a);C.trim()?n.set("q",C.trim()):n.delete("q"),n.set("page","1"),m(`/products?${n.toString()}`)};return c.useEffect(()=>{const t=new URLSearchParams(x.search);t.get("page")!=="1"&&(t.set("page","1"),m(`${x.pathname}?${t.toString()}`))},[f,x.pathname,x.search,m]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-6 flex flex-wrap justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 capitalize",children:X}),e.jsxs("p",{className:"text-sm text-gray-500",children:[k.totalItems," ",s("items_found")]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("form",{onSubmit:H,className:"relative",children:[e.jsx("input",{type:"text",value:C,onChange:t=>A(t.target.value),placeholder:s("Search placeholder"),className:"border-gray-300 rounded-md py-2 pl-10 pr-4 text-sm w-full sm:w-48 focus:ring-brand-blue focus:border-brand-blue"}),e.jsx("button",{type:"submit",className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400",children:e.jsx(ie,{className:"w-full h-full"})})]}),e.jsxs("select",{value:`${f.sortBy}-${f.order}`,onChange:t=>{const[n,b]=t.target.value.split("-");I(y=>({...y,sortBy:n,order:b}))},className:"border-gray-300 rounded-md shadow-sm text-sm focus:ring-brand-blue focus:border-brand-blue",children:[e.jsx("option",{value:"created_at-desc",children:s("sort_by_default")}),e.jsx("option",{value:"name-asc",children:s("Sort name asc")}),e.jsx("option",{value:"name-desc",children:s("Sort name desc")}),e.jsx("option",{value:"price-asc",children:s("Sort price asc")}),e.jsx("option",{value:"price-desc",children:s("Sort price desc")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsx("aside",{className:"lg:col-span-1 bg-white p-6 rounded-lg shadow-sm h-fit",children:e.jsx(Q,{filters:f,setFilters:I,availableBrands:i})}),e.jsxs("main",{className:"lg:col-span-3",children:[g?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6",children:Array.from({length:9}).map((t,n)=>e.jsx("div",{className:"border rounded-lg shadow-sm",children:e.jsx("div",{className:"w-full h-80 bg-gray-200 animate-pulse"})},n))}):j.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6",children:j.map(t=>e.jsx(le,{product:t,onQuickView:()=>$(t)},t.id))}):e.jsxs("div",{className:"col-span-full text-center py-16",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:r||s("No products found")}),e.jsx("p",{className:"text-gray-500 mt-2",children:s("Adjust filters prompt")})]}),e.jsx(ce,{pagination:k,handlePageChange:G})]})]})]}),e.jsx(me,{}),R&&e.jsx(ue,{product:R,onClose:()=>$(null)})]})};export{we as default};
